# VSCode 调试配置指南

## 🚀 快速开始

### 方法一：一键启动开发模式
1. 打开 VSCode 的"运行和调试"面板 (`Ctrl+Shift+D` / `Cmd+Shift+D`)
2. 选择 **"🚀 开发模式 (Extension + Watch)"**
3. 点击绿色播放按钮 ▶️

这将自动启动监视模式并打开新的VSCode窗口进行插件调试。

### 方法二：分步骤调试
1. **构建插件**: `Ctrl+Shift+P` > `Tasks: Run Task` > `build:dev`
2. **启动调试**: 选择 **"运行插件 (Run Extension)"** 配置
3. **开启监视**: 同时运行 `watch` 任务进行热重载

## 🔧 可用的调试配置

### 开发调试
- **运行插件 (Run Extension)**: 一次性构建并启动插件
- **运行插件 (监视模式)**: 启动监视模式，代码变更自动重新编译
- **🚀 开发模式**: 组合配置，推荐日常开发使用

### 测试调试
- **运行插件测试**: 运行扩展测试套件
- **调试当前文件**: 调试当前打开的TypeScript文件

### 高级调试
- **附加到运行中的插件**: 附加调试器到已运行的插件实例

## 🛠️ 可用的构建任务

### 开发任务
- `build:dev` - 开发模式构建 (默认)
- `build:prod` - 生产模式构建
- `watch` - 监视模式，文件变更自动重新编译
- `clean` - 清理构建产物
- `clean & build` - 清理后重新构建

### 代码质量
- `lint` - ESLint 代码检查
- `lint:fix` - 自动修复 ESLint 问题
- `TypeScript: 编译检查` - 仅检查类型，不生成文件

### 测试任务
- `test` - 运行 Jest 测试
- `test:spike` - 运行 spike 测试

## ⚡ 使用技巧

### 1. 热重载开发
```bash
# 启动监视模式
Ctrl+Shift+P > Tasks: Run Task > watch
```
然后使用 **"运行插件 (监视模式)"** 调试配置。

### 2. 快速错误定位
- 编译错误会在 **问题面板** 中显示
- 使用 `F8` 在错误间跳转
- 断点调试：在代码行号左侧点击设置断点

### 3. 调试聊天参与者
1. 启动插件调试
2. 在新窗口中打开任意工作区
3. 打开聊天面板
4. 使用 `@srs-writer` 开始对话
5. 在源代码中设置断点观察执行流程

### 4. 工具系统调试
```typescript
// 在 orchestrator.ts 中设置断点
public async processUserInput(...) {
    // 在这里设置断点观察工具执行流程
}
```

## 🎯 常见问题

### Q: 如何重新加载插件？
A: 在调试窗口中按 `Ctrl+R` / `Cmd+R` 重新加载插件

### Q: 修改代码后没有生效？
A: 确保运行了 `watch` 任务或手动运行 `build:dev`

### Q: 如何查看插件日志？
A: 打开 **输出** 面板，选择 "SRS Writer Plugin" 频道

### Q: 断点没有触发？
A: 确保：
1. Source Maps 已生成 (检查 `dist/` 目录中的 `.map` 文件)
2. 断点设置在实际会执行的代码路径上
3. 使用正确的调试配置

## 📁 项目结构
```
.vscode/
├── launch.json     # 调试配置
├── tasks.json      # 构建任务
├── settings.json   # 编辑器设置
└── README.md       # 本文档

src/               # 源代码
├── extension.ts   # 插件入口
├── chat/          # 聊天参与者
├── core/          # 核心组件
├── tools/         # 工具系统
└── ...

dist/              # 构建产物
├── extension.js   # 编译后的插件
└── *.map          # Source Maps
```

## 🔄 开发工作流

1. **开始开发**: 选择 "🚀 开发模式" 调试配置
2. **编写代码**: 在 `src/` 目录中修改代码
3. **自动构建**: `watch` 任务自动检测变更并重新编译
4. **重新加载**: 在调试窗口按 `Ctrl+R` 测试更改
5. **测试功能**: 使用 `@srs-writer` 聊天或运行测试
6. **提交代码**: 运行 `lint` 检查代码质量

Happy Debugging! 🎉 